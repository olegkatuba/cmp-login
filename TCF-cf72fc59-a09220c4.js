import{b as e,c as t,E as s,d as i,a as n,W as o,h as r,X as c,J as a,I as d,e as l,t as u,n as h,f as p,D as v,j as g,k as f,S as I,l as S}from"./index.module.js";import{l as m,c as T,p as C,E as M,u as L,o as E,d as V,f as b,h as y,$ as A,y as D,g as F,_ as O,m as R,s as P,e as w,b as G,t as _,n as U,r as k,a as N,i as B,q as x}from"./index-1278bf81-f1cfa272.js";var j=function(){function j(e,t){this.locationInstance=g.getInstance(),this.botInstance=f.getInstance(),this.previousStorage=null,this.selectedVendorsIncludeNonDisclosed=!1,this.cmpApi={},this.tcModel=null,this.tcfData=null,this.vendors=[];var s=e.tcf2,i=s.changedPurposes,n=s.cmpId,o=s.cmpVersion,r=s.consensuScriptPath,c=s.disabledSpecialFeatures,a=s.gdprApplies,d=s.hideLegitimateInterestToggles,l=s.publisherCountryCode,u=s.purposeOneTreatment,h=s.scope,p=s.selectedStacks,v=s.selectedVendorIds,m=s.tcfv2HistoryDisabled;this.changedPurposes=_(i),this.cmpId=n||5,this.cmpVersion=o||I(),this.consensuScriptPath=U(r),this.consensuSubdomain=k(e.tcf2.consensuDomain),this.disabledSpecialFeatures=c||[],this.gdprApplies=a||!1,this.hideLegitimateInterestToggles=d,this.isServiceSpecific=h===S.SERVICE,this.publisherCountryCode=l||"DE",this.purposeOneTreatment=u||!1,this.resurfaceOptions=N(e.tcf2),this.stackIds=p||[],this.tcfv2HistoryDisabled=m,this.useGranularChoice=B(e.tcf2.firstLayerHideToggles,e.tcf2.secondLayerHideToggles),this.vendorIds=v||[],this.selectedLanguage=M(e.language),this.cmpApi=new x.CmpApi(this.cmpId,this.cmpVersion,this.isServiceSpecific),this.dataTransferSettings=t}return j.prototype.updateControllerId=function(e){this.dataTransferSettings.controllerId=e},j.prototype.acceptAllDisclosed=function(i){var n,o;return e(this,void 0,void 0,(function(){var e,r,c;return t(this,(function(t){switch(t.label){case 0:return(e=this.tcModel)?(r=[],c=[],this.getVendors().forEach((function(t){var s=t.id,i=t.legitimateInterestPurposes,n=t.purposes;n.length?(e.vendorConsents.set(s),r=r.concat(n.map((function(e){return e.id})))):e.vendorConsents.unset(s),i.length?(e.vendorLegitimateInterests.set(s),c=c.concat(i.map((function(e){return e.id})))):e.vendorLegitimateInterests.unset(s)})),e.purposeConsents.set(s(r)),e.purposeLegitimateInterests.set(s(c)),this.hideLegitimateInterestToggles&&(e.unsetAllVendorLegitimateInterests(),e.unsetAllPurposeLegitimateInterests()),e.specialFeatureOptins.set(m(null===(o=null===(n=this.tcModel)||void 0===n?void 0:n.gvl)||void 0===o?void 0:o.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),this.tcModel=e,[4,this.updateTCString(i)]):[2];case 1:return t.sent(),[2]}}))}))},j.prototype.areAllPurposesAccepted=function(){var e,t;return T(this.tcModel,null===(e=this.tcModel)||void 0===e?void 0:e.gvl.stacks,null===(t=this.tcModel)||void 0===t?void 0:t.gvl.purposes,this.vendors,this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles).every((function(e){var t=!0,s=!0;return e.showConsentToggle&&null!==e.consent&&(t=e.consent),e.showLegitimateInterestToggle&&null!==e.legitimateInterestConsent&&(s=e.legitimateInterestConsent),t&&s}))},j.prototype.areAllVendorsAccepted=function(){var e,t=C(this.vendorIds,null===(e=this.tcModel)||void 0===e?void 0:e.gvl.vendors),s=this.getVendors();return t.every((function(e){var t=s.find((function(t){return t.id===e})),i=!0,n=!0;return!!t&&(t.showConsentToggle&&null!==t.consent&&(i=t.consent),t.showLegitimateInterestConsentToggle&&null!==t.legitimateInterestConsent&&(n=t.legitimateInterestConsent),i&&n)}))},j.prototype.changeLanguage=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return e=M(s),[4,this.resetGVLWithLanguage("en"===e?e+"-v2":e)];case 1:return t.sent(),this.tcModel&&this.tcModel.gvl.narrowVendorsTo(C(this.vendorIds,this.tcModel.gvl.vendors)),this.resetTcfData(),[2]}}))}))},j.prototype.denyAllDisclosed=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return this.tcModel?(this.tcModel.unsetAllVendorConsents(),this.tcModel.unsetAllVendorLegitimateInterests(),e=L(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment),this.tcModel.purposeConsents.unset(e),this.tcModel.purposeLegitimateInterests.unset(e),this.tcModel.specialFeatureOptins.unset(m(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),[4,this.updateTCString(s)]):[2];case 1:return t.sent(),[2]}}))}))},j.prototype.getSelectedVendorsIncludeNonDisclosed=function(){return this.selectedVendorsIncludeNonDisclosed},j.prototype.getTCFData=function(){var e,t,s,i,n,o,r,c,a;return this.tcfData||(this.tcfData={features:E(this.getVendors(),null===(t=null===(e=this.tcModel)||void 0===e?void 0:e.gvl)||void 0===t?void 0:t.features),purposes:T(this.tcModel,null===(s=this.tcModel)||void 0===s?void 0:s.gvl.stacks,null===(i=this.tcModel)||void 0===i?void 0:i.gvl.purposes,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles),specialFeatures:V(this.tcModel,null===(n=this.tcModel)||void 0===n?void 0:n.gvl,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.useGranularChoice),specialPurposes:b(null===(r=null===(o=this.tcModel)||void 0===o?void 0:o.gvl)||void 0===r?void 0:r.specialPurposes,this.getVendors()),stacks:y(null===(a=null===(c=this.tcModel)||void 0===c?void 0:c.gvl)||void 0===a?void 0:a.stacks,this.disabledSpecialFeatures,this.stackIds),vendors:this.getVendors()}),this.tcfData},j.prototype.getGdprApplies=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return this.gdprApplies?[4,this.locationInstance.getIsUserInEU()]:[2,!0];case 1:return[2,e.sent()]}}))}))},j.prototype.getTCString=function(){return this.tcModel?A.TCString.encode(this.tcModel):""},j.prototype.init=function(){return e(this,void 0,void 0,(function(){var e,s=this;return t(this,(function(t){switch(t.label){case 0:return this.previousStorage=i.fetchTCFData(),e="",this.isServiceSpecific?[3,3]:[4,n.init(r.COOKIE_BRIDGE,{cookieBridgeScriptPath:this.consensuScriptPath,cookieBridgeSubdomain:this.consensuSubdomain,useEuCdn:!1}).then((function(){n.setIsCookieBridgeAvailable(!0)})).catch((function(){console.warn(o.COOKIE_BRIDGE_NOT_AVAILABLE),n.removeIFrame(c)}))];case 1:return t.sent(),[4,n.getGlobalTCString().catch((function(){return console.warn(o.GET_GLOBAL_TC_STRING_FAILURE),s.isServiceSpecific=!0,""}))];case 2:e=t.sent(),t.label=3;case 3:return e||(e=i.fetchTCString()||""),[4,this.initTCModel(e,!1)];case 4:return t.sent(),this.botInstance.isRobot()&&this.acceptAllDisclosed(1),[2]}}))}))},j.prototype.setUIAsClosed=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,this.cmpApiUpdate(i.fetchTCString(),!1)]}))}))},j.prototype.setUIAsOpen=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,this.cmpApiUpdate(i.fetchTCString(),!0)]}))}))},j.prototype.shouldResurfaceUI=function(){var e=this.resurfaceOptions;return e.onIABLegalBasisChanged&&D(this.previousStorage,this.tcModel)||e.onVendorAdded&&F(this.previousStorage,this.getVendors())||e.onPurposeChanged&&O(this.previousStorage,this.getVendors())||e.onPeriodEnded&&R(this.previousStorage)},j.prototype.updateChoices=function(s,i){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return s.purposes?[4,this.savePurposes(s.purposes)]:[3,2];case 1:e.sent(),e.label=2;case 2:return s.specialFeatures?[4,this.saveSpecialFeatures(s.specialFeatures)]:[3,4];case 3:e.sent(),e.label=4;case 4:return s.vendors?[4,this.saveVendors(s.vendors)]:[3,6];case 5:e.sent(),e.label=6;case 6:return this.tcModel&&this.hideLegitimateInterestToggles&&(this.tcModel.unsetAllVendorLegitimateInterests(),this.tcModel.unsetAllPurposeLegitimateInterests()),s.purposes||s.specialFeatures||s.vendors?[4,this.updateTCString(i)]:[3,8];case 7:e.sent(),e.label=8;case 8:return[2]}}))}))},j.prototype.resetTcf=function(){this.cmpApi={},this.selectedVendorsIncludeNonDisclosed=!1,this.tcModel={},this.tcfData=null,this.vendors=[],n.removeIFrame(c)},j.prototype.applyVendorPurposeRestrictions=function(e,t,s){var i=this,n=s===a.PURPOSES?a.LEGITIMATE_INTEREST:a.PURPOSES,o=s===a.PURPOSES?A.RestrictionType.REQUIRE_CONSENT:A.RestrictionType.REQUIRE_LI;t.forEach((function(t){var r;if(-1!==e.flexiblePurposes.indexOf(t)&&-1!==e[n].indexOf(t)&&-1===e[s].indexOf(t)){var c=new A.PurposeRestriction(t,o);!1===(null===(r=i.tcModel)||void 0===r?void 0:r.publisherRestrictions.vendorHasRestriction(e.id,c))&&i.tcModel.publisherRestrictions.add(e.id,c)}}))},j.prototype.cmpApiUpdate=function(s,i){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,this.getGdprApplies()];case 1:return e.sent()?this.cmpApi.update(s,i):this.cmpApi.update(null),[2]}}))}))},j.prototype.getVendors=function(){return d(this.vendors)||this.setVendors(),this.vendors},j.prototype.initTCModel=function(s,i){return e(this,void 0,void 0,(function(){var n,r,c=this;return t(this,(function(d){switch(d.label){case 0:if(A.GVL.baseUrl=i?l:u,A.GVL.languageFilename=h,A.GVL.latestFilename=p,n=new A.GVL,this.tcModel=new A.TCModel(n),this.tcModel.cmpId=this.cmpId,this.tcModel.cmpVersion=this.cmpVersion,this.tcModel.isServiceSpecific=this.isServiceSpecific,this.tcModel.publisherCountryCode=this.publisherCountryCode,this.tcModel.purposeOneTreatment=this.purposeOneTreatment,s)try{this.tcModel=A.TCString.decode(s,this.tcModel)}catch(e){console.warn(o.INIT_TCF_ERROR,e.message)}if(null===(r=this.tcModel))throw new Error(o.TC_MODEL_UNDEFINED);if(!this.selectedLanguage)throw new Error(o.SELECTED_LANGUAGE_UNDEFINED);return[4,r.gvl.readyPromise.then((function(){return e(c,void 0,void 0,(function(){var e,s,i,n,o,c=this;return t(this,(function(t){switch(t.label){case 0:return e=C(this.vendorIds,r.gvl.vendors),this.isServiceSpecific&&(s=this.changedPurposes,i=s.purposes,n=s.legitimateInterestPurposes,e.forEach((function(e){var t=r.gvl.vendors[e];t&&(c.applyVendorPurposeRestrictions(t,i,a.PURPOSES),c.applyVendorPurposeRestrictions(t,n,a.LEGITIMATE_INTEREST))}))),o=M(this.selectedLanguage),[4,this.resetGVLWithLanguage("en"===o?o+"-v2":o)];case 1:return t.sent(),this.tcModel&&this.tcModel.gvl.narrowVendorsTo(e),this.setSelectedVendorsIncludeNonDisclosed(e),!this.isServiceSpecific&&this.tcModel&&this.tcModel.vendorsDisclosed.set(e),[2]}}))}))}))];case 1:return d.sent(),[2]}}))}))},j.prototype.resetGVLWithLanguage=function(s){var i,n;return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return e=M(s),[2,null===(n=null===(i=this.tcModel)||void 0===i?void 0:i.gvl)||void 0===n?void 0:n.changeLanguage(e).catch((function(e){console.warn(o.RESET_GVL_FAILURE,e)}))]}))}))},j.prototype.resetTcfData=function(){this.vendors=[],this.tcfData=null},j.prototype.setSelectedVendorsIncludeNonDisclosed=function(e){var t,s,n=this,o=i.fetchTCFData(),r=o.tcString,c=o.timestamp,a=o.vendors,d=o.vendorsDisclosed;if(""===r||0!==a.length||d)s=i.fetchTCFVendorsDisclosedObject();else{var l={tcString:r,timestamp:c||Date.now(),vendors:[],vendorsDisclosed:e};i.saveTCFData(l),s=i.fetchTCFVendorsDisclosedObject(null===(t=this.tcModel)||void 0===t?void 0:t.gvl)}e.some((function(e){var t;return n.isServiceSpecific?!P(e,s):!(null===(t=n.tcModel)||void 0===t?void 0:t.vendorsDisclosed.has(e))}))&&(this.selectedVendorsIncludeNonDisclosed=!0)},j.prototype.savePurposes=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return(e=this.tcModel)?(s.forEach((function(t){t.consent?e.purposeConsents.set(t.id):e.purposeConsents.unset(t.id),t.legitimateInterestConsent?e.purposeLegitimateInterests.set(t.id):e.purposeLegitimateInterests.unset(t.id)})),[2]):[2]}))}))},j.prototype.saveSpecialFeatures=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return(e=this.tcModel)?(s.forEach((function(t){t.consent?e.specialFeatureOptins.set(t.id):e.specialFeatureOptins.unset(t.id)})),[2]):[2]}))}))},j.prototype.saveVendors=function(s){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return(e=this.tcModel)?(s.forEach((function(t){t.consent?e.vendorConsents.set(t.id):e.vendorConsents.unset(t.id),t.legitimateInterestConsent?e.vendorLegitimateInterests.set(t.id):e.vendorLegitimateInterests.unset(t.id)})),[2]):[2]}))}))},j.prototype.setVendors=function(){var e;this.vendors=w(this.tcModel,null===(e=this.tcModel)||void 0===e?void 0:e.gvl,this.disabledSpecialFeatures,this.useGranularChoice,this.hideLegitimateInterestToggles,this.purposeOneTreatment)},j.prototype.updateTCString=function(s){return e(this,void 0,void 0,(function(){var e,r;return t(this,(function(t){switch(t.label){case 0:return this.tcModel&&(this.tcModel.consentScreen=s,this.tcModel.updated()),e=this.getTCString(),this.isServiceSpecific?[3,2]:[4,n.setGlobalTCString(e).catch((function(){console.warn(o.SET_GLOBAL_TC_STRING_FAILURE)}))];case 1:t.sent(),t.label=2;case 2:return r={tcString:e,timestamp:Date.now(),vendors:G(this.getVendors())},i.saveTCFData(r),[4,this.cmpApiUpdate(e,!1)];case 3:return t.sent(),this.resetTcfData(),this.botInstance.isRobot()?[3,5]:[4,v.getInstance().saveTCFConsents(this.dataTransferSettings,r,"onTcfStringChange","implicit")];case 4:t.sent(),t.label=5;case 5:return[2]}}))}))},j}();export default j;
//# sourceMappingURL=TCF-cf72fc59-a09220c4.js.map
