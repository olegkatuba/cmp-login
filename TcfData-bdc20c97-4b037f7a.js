import{A as e,b as t,c as s,E as i,d as n,a as o,W as r,h as c,X as a,J as d,I as l,e as u,t as h,n as p,f as v,D as g,j as f,k as I,S,M as m,l as T}from"./index.module.js";import{l as C,c as M,p as L,E as b,u as E,o as V,d as y,f as A,h as D,$ as F,y as R,g as O,_ as P,m as w,s as G,e as _,b as U,t as k,n as N,r as B,a as x,i as j,q as H}from"./index-1278bf81-f1cfa272.js";import W from"./DefaultData-4273ee7f-ab48332b.js";var K=function(W){function K(e,t,s){var i=W.call(this,e,s)||this;i.locationInstance=f.getInstance(),i.botInstance=I.getInstance(),i.previousStorage=null,i.selectedVendorsIncludeNonDisclosed=!1,i.cmpApi={},i.tcModel=null,i.tcfData=null,i.vendors=[];var n=e.tcf2,o=n.changedPurposes,r=n.cmpId,c=n.cmpVersion,a=n.consensuScriptPath,d=n.disabledSpecialFeatures,l=n.gdprApplies,u=n.hideLegitimateInterestToggles,h=n.publisherCountryCode,p=n.purposeOneTreatment,v=n.scope,g=n.selectedStacks,C=n.selectedVendorIds,M=n.tcfv2HistoryDisabled;return i.changedPurposes=k(o),i.cmpId=r||5,i.cmpVersion=c||S(),i.consensuScriptPath=N(a),i.consensuSubdomain=B(e.tcf2.consensuDomain),i.disabledSpecialFeatures=d||[],i.gdprApplies=m(l,!1),i.hideLegitimateInterestToggles=u,i.isServiceSpecific=v===T.SERVICE,i.publisherCountryCode=h||"DE",i.purposeOneTreatment=m(p,!1),i.resurfaceOptions=x(e.tcf2),i.stackIds=g||[],i.tcfv2HistoryDisabled=M,i.useGranularChoice=j(e.tcf2.firstLayerHideToggles,e.tcf2.secondLayerHideToggles),i.vendorIds=C||[],i.selectedLanguage=b(e.language),i.cmpApi=new H.CmpApi(i.cmpId,i.cmpVersion,i.isServiceSpecific),i.dataTransferSettings=t,i}return e(K,W),K.prototype.updateControllerId=function(e){this.dataTransferSettings.controllerId=e},K.prototype.acceptAllDisclosed=function(e){var n,o;return t(this,void 0,void 0,(function(){var t,r,c;return s(this,(function(s){switch(s.label){case 0:return(t=this.tcModel)?(r=[],c=[],this.getVendors().forEach((function(e){var s=e.id,i=e.legitimateInterestPurposes,n=e.purposes;n.length?(t.vendorConsents.set(s),r=r.concat(n.map((function(e){return e.id})))):t.vendorConsents.unset(s),i.length?(t.vendorLegitimateInterests.set(s),c=c.concat(i.map((function(e){return e.id})))):t.vendorLegitimateInterests.unset(s)})),t.purposeConsents.set(i(r)),t.purposeLegitimateInterests.set(i(c)),this.hideLegitimateInterestToggles&&(t.unsetAllVendorLegitimateInterests(),t.unsetAllPurposeLegitimateInterests()),t.specialFeatureOptins.set(C(null===(o=null===(n=this.tcModel)||void 0===n?void 0:n.gvl)||void 0===o?void 0:o.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),this.tcModel=t,[4,this.updateTCString(e)]):[2];case 1:return s.sent(),[2]}}))}))},K.prototype.areAllPurposesAccepted=function(){var e,t;return M(this.tcModel,null===(e=this.tcModel)||void 0===e?void 0:e.gvl.stacks,null===(t=this.tcModel)||void 0===t?void 0:t.gvl.purposes,this.vendors,this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles).every((function(e){var t=!0,s=!0;return e.showConsentToggle&&null!==e.consent&&(t=e.consent),e.showLegitimateInterestToggle&&null!==e.legitimateInterestConsent&&(s=e.legitimateInterestConsent),t&&s}))},K.prototype.areAllVendorsAccepted=function(){var e,t=L(this.vendorIds,null===(e=this.tcModel)||void 0===e?void 0:e.gvl.vendors),s=this.getVendors();return t.every((function(e){var t=s.find((function(t){return t.id===e})),i=!0,n=!0;return!!t&&(t.showConsentToggle&&null!==t.consent&&(i=t.consent),t.showLegitimateInterestConsentToggle&&null!==t.legitimateInterestConsent&&(n=t.legitimateInterestConsent),i&&n)}))},K.prototype.changeLanguage=function(e){return t(this,void 0,void 0,(function(){var t;return s(this,(function(s){switch(s.label){case 0:return t=b(e),[4,this.resetGVLWithLanguage("en"===t?t+"-v2":t)];case 1:return s.sent(),this.tcModel&&this.tcModel.gvl.narrowVendorsTo(L(this.vendorIds,this.tcModel.gvl.vendors)),this.resetTcfData(),[2]}}))}))},K.prototype.denyAllDisclosed=function(e){return t(this,void 0,void 0,(function(){var t;return s(this,(function(s){switch(s.label){case 0:return this.tcModel?(this.tcModel.unsetAllVendorConsents(),this.tcModel.unsetAllVendorLegitimateInterests(),t=E(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment),this.tcModel.purposeConsents.unset(t),this.tcModel.purposeLegitimateInterests.unset(t),this.tcModel.specialFeatureOptins.unset(C(this.tcModel.gvl.stacks,this.getVendors(),this.disabledSpecialFeatures,this.stackIds)),[4,this.updateTCString(e)]):[2];case 1:return s.sent(),[2]}}))}))},K.prototype.getSelectedVendorsIncludeNonDisclosed=function(){return this.selectedVendorsIncludeNonDisclosed},K.prototype.getTCFData=function(){var e,t,s,i,n,o,r,c,a;return this.tcfData||(this.tcfData={features:V(this.getVendors(),null===(t=null===(e=this.tcModel)||void 0===e?void 0:e.gvl)||void 0===t?void 0:t.features),purposes:M(this.tcModel,null===(s=this.tcModel)||void 0===s?void 0:s.gvl.stacks,null===(i=this.tcModel)||void 0===i?void 0:i.gvl.purposes,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.purposeOneTreatment,this.useGranularChoice,this.hideLegitimateInterestToggles),specialFeatures:y(this.tcModel,null===(n=this.tcModel)||void 0===n?void 0:n.gvl,this.getVendors(),this.disabledSpecialFeatures,this.stackIds,this.useGranularChoice),specialPurposes:A(null===(r=null===(o=this.tcModel)||void 0===o?void 0:o.gvl)||void 0===r?void 0:r.specialPurposes,this.getVendors()),stacks:D(null===(a=null===(c=this.tcModel)||void 0===c?void 0:c.gvl)||void 0===a?void 0:a.stacks,this.disabledSpecialFeatures,this.stackIds),vendors:this.getVendors()}),this.tcfData},K.prototype.getGdprApplies=function(){return t(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.gdprApplies?[4,this.locationInstance.getIsUserInEU()]:[2,!0];case 1:return[2,e.sent()]}}))}))},K.prototype.getTCString=function(){return this.tcModel?F.TCString.encode(this.tcModel):""},K.prototype.init=function(){return t(this,void 0,void 0,(function(){var e,t=this;return s(this,(function(s){switch(s.label){case 0:return this.previousStorage=n.fetchTCFData(),e="",this.isServiceSpecific?[3,3]:[4,o.init(c.COOKIE_BRIDGE,{cookieBridgeScriptPath:this.consensuScriptPath,cookieBridgeSubdomain:this.consensuSubdomain,useEuCdn:!1}).then((function(){o.setIsCookieBridgeAvailable(!0)})).catch((function(){console.warn(r.COOKIE_BRIDGE_NOT_AVAILABLE),o.removeIFrame(a)}))];case 1:return s.sent(),[4,o.getGlobalTCString().catch((function(){return console.warn(r.GET_GLOBAL_TC_STRING_FAILURE),t.isServiceSpecific=!0,""}))];case 2:e=s.sent(),s.label=3;case 3:return e||(e=n.fetchTCString()||""),[4,this.initTCModel(e,!1)];case 4:return s.sent(),this.botInstance.isRobot()&&this.acceptAllDisclosed(1),[2]}}))}))},K.prototype.setUIAsClosed=function(){return t(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this.cmpApiUpdate(n.fetchTCString(),!1)]}))}))},K.prototype.setUIAsOpen=function(){return t(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this.cmpApiUpdate(n.fetchTCString(),!0)]}))}))},K.prototype.shouldResurfaceUI=function(){var e=this.resurfaceOptions;return e.onIABLegalBasisChanged&&R(this.previousStorage,this.tcModel)||e.onVendorAdded&&O(this.previousStorage,this.getVendors())||e.onPurposeChanged&&P(this.previousStorage,this.getVendors())||e.onPeriodEnded&&w(this.previousStorage)},K.prototype.updateChoices=function(e,i){return t(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e.purposes?[4,this.savePurposes(e.purposes)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.specialFeatures?[4,this.saveSpecialFeatures(e.specialFeatures)]:[3,4];case 3:t.sent(),t.label=4;case 4:return e.vendors?[4,this.saveVendors(e.vendors)]:[3,6];case 5:t.sent(),t.label=6;case 6:return this.tcModel&&this.hideLegitimateInterestToggles&&(this.tcModel.unsetAllVendorLegitimateInterests(),this.tcModel.unsetAllPurposeLegitimateInterests()),e.purposes||e.specialFeatures||e.vendors?[4,this.updateTCString(i)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2]}}))}))},K.prototype.resetTcf=function(){this.cmpApi={},this.selectedVendorsIncludeNonDisclosed=!1,this.tcModel={},this.tcfData=null,this.vendors=[],o.removeIFrame(a)},K.prototype.applyVendorPurposeRestrictions=function(e,t,s){var i=this,n=s===d.PURPOSES?d.LEGITIMATE_INTEREST:d.PURPOSES,o=s===d.PURPOSES?F.RestrictionType.REQUIRE_CONSENT:F.RestrictionType.REQUIRE_LI;t.forEach((function(t){var r;if(-1!==e.flexiblePurposes.indexOf(t)&&-1!==e[n].indexOf(t)&&-1===e[s].indexOf(t)){var c=new F.PurposeRestriction(t,o);!1===(null===(r=i.tcModel)||void 0===r?void 0:r.publisherRestrictions.vendorHasRestriction(e.id,c))&&i.tcModel.publisherRestrictions.add(e.id,c)}}))},K.prototype.cmpApiUpdate=function(e,i){return t(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.getGdprApplies()];case 1:return t.sent()?this.cmpApi.update(e,i):this.cmpApi.update(null),[2]}}))}))},K.prototype.getVendors=function(){return l(this.vendors)||this.setVendors(),this.vendors},K.prototype.initTCModel=function(e,i){return t(this,void 0,void 0,(function(){var n,o,c=this;return s(this,(function(a){switch(a.label){case 0:if(F.GVL.baseUrl=i?u:h,F.GVL.languageFilename=p,F.GVL.latestFilename=v,n=new F.GVL,this.tcModel=new F.TCModel(n),this.tcModel.cmpId=this.cmpId,this.tcModel.cmpVersion=this.cmpVersion,this.tcModel.isServiceSpecific=this.isServiceSpecific,this.tcModel.publisherCountryCode=this.publisherCountryCode,this.tcModel.purposeOneTreatment=this.purposeOneTreatment,e)try{this.tcModel=F.TCString.decode(e,this.tcModel)}catch(e){console.warn(r.INIT_TCF_ERROR,e.message)}if(null===(o=this.tcModel))throw new Error(r.TC_MODEL_UNDEFINED);if(!this.selectedLanguage)throw new Error(r.SELECTED_LANGUAGE_UNDEFINED);return[4,o.gvl.readyPromise.then((function(){return t(c,void 0,void 0,(function(){var e,t,i,n,r,c=this;return s(this,(function(s){switch(s.label){case 0:return e=L(this.vendorIds,o.gvl.vendors),this.isServiceSpecific&&(t=this.changedPurposes,i=t.purposes,n=t.legitimateInterestPurposes,e.forEach((function(e){var t=o.gvl.vendors[e];t&&(c.applyVendorPurposeRestrictions(t,i,d.PURPOSES),c.applyVendorPurposeRestrictions(t,n,d.LEGITIMATE_INTEREST))}))),r=b(this.selectedLanguage),[4,this.resetGVLWithLanguage("en"===r?r+"-v2":r)];case 1:return s.sent(),this.tcModel&&this.tcModel.gvl.narrowVendorsTo(e),this.setSelectedVendorsIncludeNonDisclosed(e),!this.isServiceSpecific&&this.tcModel&&this.tcModel.vendorsDisclosed.set(e),[2]}}))}))}))];case 1:return a.sent(),[2]}}))}))},K.prototype.resetGVLWithLanguage=function(e){var i,n;return t(this,void 0,void 0,(function(){var t;return s(this,(function(s){return t=b(e),[2,null===(n=null===(i=this.tcModel)||void 0===i?void 0:i.gvl)||void 0===n?void 0:n.changeLanguage(t).catch((function(e){console.warn(r.RESET_GVL_FAILURE,e)}))]}))}))},K.prototype.resetTcfData=function(){this.vendors=[],this.tcfData=null},K.prototype.setSelectedVendorsIncludeNonDisclosed=function(e){var t=this,s=n.fetchTCFVendorsDisclosedObject();e.some((function(e){var i;return t.isServiceSpecific?!G(e,s):!(null===(i=t.tcModel)||void 0===i?void 0:i.vendorsDisclosed.has(e))}))&&(this.selectedVendorsIncludeNonDisclosed=!0)},K.prototype.savePurposes=function(e){return t(this,void 0,void 0,(function(){var t;return s(this,(function(s){return(t=this.tcModel)?(e.forEach((function(e){e.consent?t.purposeConsents.set(e.id):t.purposeConsents.unset(e.id),e.legitimateInterestConsent?t.purposeLegitimateInterests.set(e.id):t.purposeLegitimateInterests.unset(e.id)})),[2]):[2]}))}))},K.prototype.saveSpecialFeatures=function(e){return t(this,void 0,void 0,(function(){var t;return s(this,(function(s){return(t=this.tcModel)?(e.forEach((function(e){e.consent?t.specialFeatureOptins.set(e.id):t.specialFeatureOptins.unset(e.id)})),[2]):[2]}))}))},K.prototype.saveVendors=function(e){return t(this,void 0,void 0,(function(){var t;return s(this,(function(s){return(t=this.tcModel)?(e.forEach((function(e){e.consent?t.vendorConsents.set(e.id):t.vendorConsents.unset(e.id),e.legitimateInterestConsent?t.vendorLegitimateInterests.set(e.id):t.vendorLegitimateInterests.unset(e.id)})),[2]):[2]}))}))},K.prototype.setVendors=function(){var e;this.vendors=_(this.tcModel,null===(e=this.tcModel)||void 0===e?void 0:e.gvl,this.disabledSpecialFeatures,this.useGranularChoice,this.hideLegitimateInterestToggles,this.purposeOneTreatment)},K.prototype.updateTCString=function(e){return t(this,void 0,void 0,(function(){var t,i;return s(this,(function(s){switch(s.label){case 0:return this.tcModel&&(this.tcModel.consentScreen=e,this.tcModel.updated()),t=this.getTCString(),this.isServiceSpecific?[3,2]:[4,o.setGlobalTCString(t).catch((function(){console.warn(r.SET_GLOBAL_TC_STRING_FAILURE)}))];case 1:s.sent(),s.label=2;case 2:return i={tcString:t,timestamp:Date.now(),vendors:U(this.getVendors())},n.saveTCFData(i),[4,this.cmpApiUpdate(t,!1)];case 3:return s.sent(),this.resetTcfData(),this.botInstance.isRobot()?[3,5]:[4,g.getInstance().saveTCFConsents(this.dataTransferSettings,i,"onTcfStringChange","implicit")];case 4:s.sent(),s.label=5;case 5:return[2]}}))}))},K}(W);export default K;
//# sourceMappingURL=TcfData-bdc20c97-4b037f7a.js.map
